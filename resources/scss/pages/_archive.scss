// SPDX-License-Identifier: CC BY-NC-SA 4.0

///
/// Archive Page
///
/// Styles für die Comic-Archiv Übersicht.
///

/*!
 * @file      resources/scss/pages/_archive.scss
 * @link      ftk.jus-or.de
 *
 * @copyright (c) 2025 Felix Maywald. CC BY-NC-SA 4.0
 * @license   https://github.com/RaptorXilef/twokinds.4lima.de/blob/main/LICENSE
 *
 * @author    Felix Maywald (@RaptorXilef)
 * @link      https://github.com/RaptorXilef/twokinds.4lima.de
 */

///
/// @since    5.0.0
/// - Refactoring auf CSS Vars.
/// - style(Linter): Spezifitätsprobleme bei Link-Hover behoben.
/// - style(Linter): Link-Hover Reihenfolge korrigiert.
/// - fix(CSS): Linter-Fehler (no-descending-specificity) durch Umsortierung der Hover-States behoben.
/// - style(Linter): Block-Reihenfolge getauscht (.chapter-links vor .chapter) und Img-Selektoren sortiert.
/// - style(Linter): Interne Reihenfolge von Links und Bildern in .chapter-links korrigiert (Low -> High Specificity).
/// - style(Linter): Theme-Overrides separiert und ans Ende verschoben.
/// - chore(Linter): False-Positive bei Dark-Mode Link-Spezifität global für den Theme-Block ignoriert.
/// - style(Linter): Reihenfolge der Haupt-Blöcke optimiert, um no-descending-specificity endgültig zu lösen.
///

@use '../abstracts/variables' as *;
@use '../abstracts/mixins' as *;

// 1. Chapter Block (Text & Headlines) - Low Specificity container elements
.chapter {
    font-size: 14px;
    margin-bottom: 15px;

    p {
        margin-inline: 0.5rem;
        margin-top: 0.3rem;
        text-align: justify;
        color: var(--text-color);

        a {
            color: var(--text-on-medium); // Im Original Schwarz

            // Nesting für korrekte Specificity
            body.theme-night & {
                color: var(--link-color);
            }
        }
    }

    h2 {
        display: inline-block;
        margin: 0;
        cursor: pointer;
        color: var(--text-on-medium);
        font-size: 1.2em;

        body.theme-night & {
            color: var(--text-color);
        }

        @include media-retina-mobile {
            font-size: 2em;
        }
    }

    h4:hover {
        text-decoration: underline;
    }
}

// 2. Chapter Links Block (Images & Grid) - High Specificity components
// stylelint-disable no-descending-specificity
.chapter-links {
    display: flex;
    flex-flow: row wrap;
    gap: 6px;

    noscript {
        display: block;
    }

    // 1. Generic Link (Low Specificity)
    a {
        display: inline-block;
        width: 80px;
        height: 104px;
        background-color: #eee; // Fallback
        background-color: var(
            --button-bg
        ); // Nutzt Button-BG für Konsistenz (hell/dunkel)

        text-decoration: none;
        color: var(--text-on-medium);
        font-size: 1.2em;
        position: relative;
        overflow: hidden;

        // Hover
        &:hover {
            box-shadow: 0 0 5px rgb(0 0 0 / 30%);
            background-color: var(--button-hover-bg);
        }

        @include media-retina-mobile {
            zoom: 1.8;
        }

        span {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
            text-align: center;
            position: absolute;
            top: 0;
            left: 0;
            z-index: 80;
        }

        .delete {
            position: absolute;
            z-index: 91;
            top: 4px;
            right: 2px;
            background: none;
            margin: 0;
            padding: 0;

            @include media-retina-mobile {
                top: 3px;
            }

            svg {
                width: 24px;
                height: 24px;
                color: #f00;
                stroke: #fff;
                stroke-width: 2px;
                filter: drop-shadow(0 0 1px rgb(0 0 0 / 50%));

                @include media-retina-mobile {
                    width: 16px;
                    height: 16px;
                }
            }

            &:hover svg {
                color: #c00;
            }
        }
    }

    // 2. Specific Link Context (Higher Specificity)
    &.tag-page-links a {
        width: 100px;
        height: 130px;

        @include media-retina-mobile {
            zoom: 1.5;
        }
    }

    // 3. Image Logic (Low Spec -> High Spec)

    // a) noscript (0-0-3)
    a noscript img {
        opacity: 1;
    }

    // b) img:not (0-1-1)
    img:not(.delicon) {
        opacity: 0;
        transition: opacity 0.5s;
        object-fit: contain;
        max-width: 100%;
        position: absolute;
        top: 50%;
        left: 0;
        transform: translateY(-50%);
        z-index: 90;
    }

    // c) a.loaded img (0-1-2)
    a.loaded img,
    &.tag-page-links a img {
        opacity: 1;
    }

    // 4. Overlay Logic
    a.loaded span,
    a.noscript span,
    &.tag-page-links a span {
        background-color: rgb(0 0 0 / 50%);
        color: #fff;
        display: none;
        z-index: 100;

        @include media-retina-mobile {
            display: inline-block;
            height: auto;
            bottom: 0;
            top: inherit;
            padding-top: 0;
        }
    }

    a.loaded:hover span,
    a.noscript:hover span,
    &.tag-page-links a:hover span {
        display: flex;
    }

    // 5. Theme Overrides (Highest Specificity - Grouped at End)
    body.theme-night & {
        a {
            color: var(--text-color);
        }

        a.loaded span,
        a.noscript span,
        &.tag-page-links a span {
            background-color: rgb(0 0 0 / 65%);
            color: var(--text-color);
        }
    }
}
// stylelint-enable no-descending-specificity
