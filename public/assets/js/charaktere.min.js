let debugMode=typeof window.phpDebugMode!=="undefined"?window.phpDebugMode:false;(()=>{if(debugMode)console.log("DEBUG: charaktere.js wird geladen.");document.addEventListener("DOMContentLoaded",()=>{if(debugMode)console.log("DEBUG: DOMContentLoaded in charaktere.js.");const lazyImages=document.querySelectorAll(".char-detail img.lazy-char-img[data-src]");if(lazyImages.length===0){if(debugMode)console.log("DEBUG: Keine Bilder für Lazy Loading gefunden.");return}if("IntersectionObserver"in window){if(debugMode)console.log("DEBUG: IntersectionObserver wird verwendet.");const lazyImageObserver=new IntersectionObserver((entries,observer)=>{entries.forEach(entry=>{if(entry.isIntersecting){const lazyImage=entry.target;if(debugMode)console.log("DEBUG: Bild im Viewport, lade:",lazyImage.dataset.src);lazyImage.src=lazyImage.dataset.src;lazyImage.classList.remove("lazy-char-img");lazyImage.classList.add("loaded");lazyImage.addEventListener("load",()=>{if(debugMode)console.log("DEBUG: Bild geladen und 'loaded' Klasse hinzugefügt:",lazyImage.src)});lazyImage.addEventListener("error",()=>{if(debugMode)console.error("DEBUG: Fehler beim Laden des Bildes:",lazyImage.dataset.src);lazyImage.src="https://placehold.co/150x150/cccccc/000000?text=Fehler"});observer.unobserve(lazyImage)}})},{rootMargin:"0px 0px 100px 0px"});lazyImages.forEach(lazyImage=>{lazyImageObserver.observe(lazyImage)});if(debugMode)console.log("DEBUG: IntersectionObserver für "+lazyImages.length+" Bilder eingerichtet.")}else{if(debugMode)console.log("DEBUG: IntersectionObserver nicht unterstützt, Fallback auf Scroll-Event.");const lazyLoad=()=>{if(debugMode)console.log("DEBUG: Scroll-Event ausgelöst, überprüfe Bilder.");lazyImages.forEach(lazyImage=>{if(lazyImage.getBoundingClientRect().top<window.innerHeight+100&&lazyImage.getBoundingClientRect().bottom>-100){if(debugMode)console.log("DEBUG: Bild im Viewport (Fallback), lade:",lazyImage.dataset.src);lazyImage.src=lazyImage.dataset.src;lazyImage.classList.remove("lazy-char-img");lazyImage.classList.add("loaded");lazyImage.addEventListener("load",()=>{});lazyImage.addEventListener("error",()=>{if(debugMode)console.error("DEBUG: Fehler beim Laden des Bildes (Fallback):",lazyImage.dataset.src);lazyImage.src="https://placehold.co/150x150/cccccc/000000?text=Fehler"})}});if(document.querySelectorAll(".char-detail img.lazy-char-img[data-src]").length===0){document.removeEventListener("scroll",lazyLoad);window.removeEventListener("resize",lazyLoad);window.removeEventListener("orientationchange",lazyLoad);if(debugMode)console.log("DEBUG: Alle Bilder geladen, Scroll-Listener entfernt.")}};document.addEventListener("scroll",lazyLoad);window.addEventListener("resize",lazyLoad);window.addEventListener("orientationchange",lazyLoad);lazyLoad();if(debugMode)console.log("DEBUG: Fallback-Lazy-Loading für "+lazyImages.length+" Bilder eingerichtet.")}})})();